<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="edu.eci.pdsw.persistence.mybatisimpl.mappers.InitiativeMapper">

    <resultMap type='Initiative' id='InitiativeResult'>
        <id property='id' column='id'/>        
        <result property='description' column='description'/>
		<result property='area' column='area'/>
		<result property='numVotes' column='num_votos'/>
		<result property='startDate' column='creation_date'/>
		<result property='modifyDate' column='modify_date'/>
		<association property='user' javaType='User' resultMap='edu.eci.pdsw.persistence.mybatisimpl.mappers.UserMapper.UserResult'></association>
		<association property='status' javaType='TypeStatus' resultMap='edu.eci.pdsw.persistence.mybatisimpl.mappers.InitiativeMapper.StatusResult'></association>
		<collection property='keyWords' ofType='java.lang.String' javaType="list">
			<result column='word' />
		</collection>
    </resultMap>
    
    <resultMap type='TypeStatus' id='StatusResult'>
    	<id property='id' column='id'/>        
        <result property='status' column='status'/>
    </resultMap>
     
    
	
	<insert id="insertInitiative" parameterType="Initiative">
		INSERT INTO "initiative"
		(id, description, area, num_votos,creation_date,User_id,modify_date,type_status_id) 
		VALUES((select count(*)+1 from "initiative"),#{description},#{area},#{nvotos},#{creation},#{idus},#{modification},#{state})
	</insert>
	
	<select id="load" resultMap="InitiativeResult" parameterType="map">
        SELECT i.id,
				i.description,
				i.area,
				i.creation_date,
				i.modify_date,
				i.user_id,
				i.type_status_id,
				i.num_votos,
				kw.word
        FROM Initiative as i, Key_words as kw, word_initiative as wi
		WHERE kw.word= #{keyword} and kw.id=wi.Key_words_id and wi.Initiative_id=i.id
    </select>
    
    <select id='loadId' resultMap= 'InitiativeResult' parameterType='map'>
    
    	 SELECT i.id,
				i.description,
				i.area,
				i.creation_date,
				i.modify_date,
				i.user_id,
				i.type_status_id,
				i.num_votos,
				kw.word
		    FROM Initiative as i, Key_words as kw, word_initiative as wi
		    where kw.id=wi.Key_words_id and i.id=#{id};
    </select>
	
</mapper>